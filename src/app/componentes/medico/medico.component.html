<div class="container">
  <header></header>

  <main>
    <h1 style="text-align: center;">¡Bienvenido {{ nombreMedico }}!</h1>
    <h2 style="text-align: center;">Seleccione una opción para continuar</h2>

    <div class="main-buttons" @fadeInOut>
      <button (click)="toggleTurnosList()" @fadeInOut>Turnos Pacientes</button>
      <button (click)="mostrarHistorialTurnosMed()" @fadeInOut>Historial</button>
    </div>

    <!-- SECCIÓN TURNOS PACIENTES -->
    <div class="table-responsive" *ngIf="showTurnosList" @fadeInOut>
      <h2 class="col-6">Lista de Turnos</h2>
      <button (click)="generarCSV()" @fadeInOut>Exportar a CSV</button>

      <table class="table table-striped" @fadeInOut>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>DNI</th>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Estado</th>
            <th>Procesar Turno</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let turno of turnos" @fadeInOut>
            <td>{{ turno.paciente }}</td>
            <td>{{ turno.dniPaciente }}</td>
            <td>{{ turno.fecha }}</td>
            <td>{{ turno.hora }}</td>
            <td>{{ turno.estado }}</td>
            <td>
              <button (click)="openModal(turno)" @fadeInOut>Seleccionar</button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Modal de opciones de turno -->
      <div class="modal" *ngIf="isModalOpen" @fadeInOut>
        <div class="modal-content" @fadeInOut>
          <h3>Seleccione una opción</h3>
          <form (ngSubmit)="enviarOpciones()">
            <label>
              <input type="radio" name="opcion" [(ngModel)]="opcionSeleccionada" value="CONFIRMADO" required />
              Aceptar
            </label>
            <label>
              <input type="radio" name="opcion" [(ngModel)]="opcionSeleccionada" value="CANCELADO" />
              Rechazar
            </label>
            <label>
              <input type="radio" name="opcion" [(ngModel)]="opcionSeleccionada" value="FINALIZADO" />
              Finalizar
            </label>

            <div class="modal-actions">
              <button type="submit" @fadeInOut>Enviar</button>
              <button type="button" (click)="closeModal()" @fadeInOut>Cancelar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- SECCIÓN HISTORIAL -->
    <div *ngIf="mostrarHistorial" @fadeInOut>
      <h2>Historial de Turnos</h2>
      <h5>Seleccione un turno para ver las observaciones</h5>

      <table class="historial-table" @fadeInOut>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Estado</th>
            <th>Observaciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let turno of historialTurnos"
            [ngClass]="{
            'estado-cancelado': turno.estado?.trim().toLowerCase() === 'cancelado',
            'estado-activo': turno.estado?.trim().toLowerCase() === 'confirmado'
            }"
            (click)="mostrarObservaciones(turno)"
            @fadeInOut>
        <td>{{ turno.fecha }}</td>
        <td>{{ turno.hora }}</td>
        <td>{{ turno.estado }}</td>
        <td>{{ turno.observaciones || 'Sin observaciones' }}</td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- MODAL DE OBSERVACIONES -->
    <div class="modal" *ngIf="mostrarModal" @fadeInOut>
      <div class="modal-content" @fadeInOut>
        <h3>Agregar Observaciones</h3>
        <textarea
          [(ngModel)]="observaciones"
          rows="4"
          cols="50"
          placeholder="Escribe tus observaciones aquí..."
        ></textarea>

        <div class="modal-actions">
          <button (click)="guardarObservaciones(turno)" @fadeInOut>Guardar</button>
          <button (click)="cerrarModal()" @fadeInOut>Cancelar</button>
        </div>
      </div>
    </div>
  </main>
</div>
