<div class="container">
    <header>
      <!-- <div class="logo">
        <img src="logo.png" alt="prueba">
      </div> -->
    </header>
  
    <main>
      <h1 style="text-align: center;">
        Bienvenido a la secci√≥n de administraci√≥n {{ datoU.nombre }}
      </h1>

      <h1 style="text-align: center;">Seleccione una opci√≥n para continuar</h1>
      <div class="main-buttons" @fadeInOut>
        <button (click)="setActive('habilitacion')" @fadeInOut>Habilitaci√≥n</button >
        <button (click)="setActive('turnos')"@fadeInOut>Turnos</button>
        <button (click)="setActive('disponibilidad')"@fadeInOut>Disponibilidad</button>
        <button (click)="setActive('informes')"@fadeInOut>Informes</button>
        <button (click)="setActive('administrar')"@fadeInOut>Administrar</button>
      </div>
  
      <!-- Habilitacion -->
      <div class="table-responsive" *ngIf="activeSection === 'habilitacion'" @fadeInOut>
        <input type="text" [(ngModel)]="filtro" placeholder="Buscar m√©dicos">
        <table class="table table-striped" id="medicosTable">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Apellido</th>
              <th>DNI</th>
              <th>Matr√≠cula</th>
              <th>Especialidad</th>
              <th>Acci√≥n</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let medico of medicos | medicos: filtro">
              <td>{{ medico.nombre }}</td>
              <td>{{ medico.apellido }}</td>
              <td>{{ medico.dni }}</td>
              <td>{{ medico.matricula }}</td>
              <td>{{ medico.especialidad }}</td>
              <td>
                <button class="btn-success" *ngIf="medico.habilitacion == true" (click)="accion(medico)"@fadeInOut>Habilitado</button>
                <button class="btn-danger" *ngIf="medico.habilitacion == false" (click)="accion(medico)"@fadeInOut>No habilitado</button>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="main-buttons">
          <button (click)="generarPDF()"@fadeInOut>Imprimir Lista</button>
        </div>
      </div>

     <!-- Disponibilidad -->
      <form *ngIf="activeSection === 'disponibilidad'" (ngSubmit)="enviarDisponibilidad()" @fadeInOut>
        <p><strong>M√©dico:</strong> {{ medicoSeleccionado?.nombre }} {{ medicoSeleccionado?.apellido }}</p>
        
        <label for="desde">Hora Desde:</label>
        <input type="time" id="desde" [(ngModel)]="disponibilidad.desde" name="desde" required>

        <label for="hasta">Hora Hasta:</label>
        <input type="time" id="hasta" [(ngModel)]="disponibilidad.hasta" name="hasta" required>

        <label for="dias">D√≠as:</label>
        <div class="dias-container">
          <button type="button" 
                  *ngFor="let dia of dias"
                  (click)="toggleDia(dia.value)"
                  [ngClass]="{'selected': disponibilidad.dias.includes(dia.value)}"@fadeInOut>
            {{ dia.nombre }}
          </button>
        </div>

        <button type="submit" id="dispo"@fadeInOut>Enviar Disponibilidad</button>
      </form>
      <!-- Placeholder para otras secciones -->
      <div *ngIf="activeSection === 'administrar'" class="admin-section" @fadeInOut>
        <h3>Administrar usuarios</h3>

        <form #adminForm="ngForm" (ngSubmit)="guardarUsuario()">
          <!-- Tipo de usuario -->
          <label for="tipoUsuario">Tipo de usuario:</label>
          <select id="tipoUsuario" name="tipoUsuario" [(ngModel)]="nuevoUsuario.tipoUsuario" required>
            <option value="">Seleccione una opci√≥n</option>
            <option value="medico">M√©dico</option>
            <option value="administrativo">Administrativo</option>
            <option value="tecnico">T√©cnico</option>
          </select>

          <hr />

          <!-- Campos b√°sicos -->
          <div class="form-group">
            <label>Nombre:</label>
            <input type="text" name="nombre" [(ngModel)]="nuevoUsuario.nombre" required />
          </div>

          <div class="form-group">
            <label>Apellido:</label>
            <input type="text" name="apellido" [(ngModel)]="nuevoUsuario.apellido" required />
          </div>

          <div class="form-group">
            <label>Email:</label>
            <input type="email" name="email" [(ngModel)]="nuevoUsuario.email" required />
          </div>

          <div class="form-group">
            <label>DNI:</label>
            <input type="text" name="dni" [(ngModel)]="nuevoUsuario.dni" required />
          </div>

          <div class="form-group">
            <label>Tel√©fono:</label>
            <input type="text" name="telefono" [(ngModel)]="nuevoUsuario.telefono" required />
          </div>

          <!-- Solo para m√©dico o t√©cnico -->
          <div *ngIf="esMedicoOTecnico()" class="form-group">
            <label>Matr√≠cula:</label>
            <input type="text" name="matricula" [(ngModel)]="nuevoUsuario.matricula" />
          </div>

          <div *ngIf="esMedicoOTecnico()" class="form-group">
            <label>Especialidad:</label>
            <input type="text" name="especialidad" [(ngModel)]="nuevoUsuario.especialidad" />
          </div>

          <div class="form-group">
            <label>Contrase√±a:</label>
            <input type="text" name="telefono" [(ngModel)]="nuevoUsuario.contrasenia" required />
          </div>

          <button class="botonGuardar" type="submit"@fadeInOut>Guardar</button>
        </form>
      </div>


      <!-- SECCI√ìN TURNOS -->
      <div *ngIf="activeSection === 'turnos'" @fadeInOut>
        <h3 style="text-align: center;">Turnos del d√≠a {{ fechaActual | date:'dd/MM/yyyy' }}</h3>

        <div class="turnos-container">
          <div class="filters">
            <button (click)="obtenerTurnosDelDia()" class="botonActualizar">üîÑ Actualizar</button>
          </div>

          <table class="table table-striped" *ngIf="turnos && turnos.length > 0" @fadeInOut>
            <thead>
              <tr>
                <th>Hora</th>
                <th>M√©dico</th>
                <th>Especialidad</th>
                <th>Paciente</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let turno of turnos" @fadeInOut>
                <td>{{ turno.hora }}</td>
                <td>{{ turno.nombreMedico }} {{ turno.apellidoMedico }}</td>
                <td>{{ turno.especialidad }}</td>
                <td>{{ turno.nombrePaciente }} {{ turno.apellidoPaciente }}</td>
                <td>
                  <span [ngClass]="{
                    'estado-pendiente': turno.estado === 'Pendiente',
                    'estado-confirmado': turno.estado === 'Confirmado',
                    'estado-cancelado': turno.estado === 'Cancelado'
                  }">
                    {{ turno.estado }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>

          <div *ngIf="turnos && turnos.length === 0" class="no-turnos" @fadeInOut>
            <p>No hay turnos registrados para hoy.</p>
          </div>
        </div>
      </div>


      <div *ngIf="activeSection === 'informes'">
      <h3 style="text-align: center;">Secci√≥n de Informes</h3>
      <p style="text-align: center;">Seleccione el tipo de informe que desea generar:</p>

      <div class="main-buttons">
        <button (click)="abrirModal('turnosPorFecha')"@fadeInOut>Turnos m√©dicos por fecha</button>
        <button (click)="abrirModal('medicosPorEspecialidad')"@fadeInOut>M√©dicos por especialidad</button>
        <button (click)="abrirModal('medicosPorDia')"@fadeInOut>M√©dicos por d√≠a</button>
      </div>

      <!-- Modal: Turnos por fecha -->
      <div class="modal" *ngIf="modalActivo === 'turnosPorFecha'" @fadeInOut>
        <div class="modal-content">
          <h3>Informe: Turnos m√©dicos por fecha</h3>
          <label>Fecha desde:</label>
          <input type="date" [(ngModel)]="filtros.fechaDesde">
          <label>Fecha hasta:</label>
          <input type="date" [(ngModel)]="filtros.fechaHasta">
          <div class="modal-actions">
            <button (click)="generarInforme('turnosPorFecha')"@fadeInOut>Generar</button>
            <button (click)="cerrarModal()" @fadeInOut>Cancelar</button>
          </div>
        </div>
      </div>
      <!-- Modal: M√©dicos por d√≠a -->
      <div class="modal" *ngIf="modalActivo === 'medicosPorDia'" @fadeInOut>
        <div class="modal-content">
          <h3>Informe: M√©dicos por d√≠a</h3>
          <label>D√≠a de la semana:</label>
          <select [(ngModel)]="filtros.dia">
            <option value="">Seleccione un d√≠a</option>
            <option *ngFor="let d of dias" [value]="d.value">{{ d.nombre }}</option>
          </select>
          <div class="modal-actions">
            <button (click)="generarInforme('medicosPorDia')"@fadeInOut>Generar</button>
            <button (click)="cerrarModal()"@fadeInOut>Cancelar</button>
          </div>
        </div>
      </div>

      <!-- Modal: M√©dicos por especialidad -->
      <div class="modal" *ngIf="modalActivo === 'medicosPorEspecialidad'" @fadeInOut>
        <div class="modal-content">
          <h3>Informe: M√©dicos por especialidad</h3>
          <label>Especialidad:</label>
          <input type="text" [(ngModel)]="filtros.especialidad" placeholder="Ej: Cardiolog√≠a">
          <div class="modal-actions">
            <button (click)="generarInforme('medicosPorEspecialidad')">Generar</button>
            <button (click)="cerrarModal()">Cancelar</button>
          </div>
        </div>
      </div>


      <!-- Resultado -->
      <div class="informe-result" *ngIf="resultadoInforme">
        <h4>Resultado del informe:</h4>
        <pre>{{ resultadoInforme | json }}</pre>
      </div>
    </div>


      <!--Modal para manejar la disponibilidad del medico-->
        <div class="modal" *ngIf="isModalOpen" @fadeInOut>
        <div class="modal-content">
          <h3>Buscar M√©dico por DNI</h3>
          <input type="text" [(ngModel)]="dniMedico" placeholder="Ingrese DNI">
          <div class="modal-actions">
            <button (click)="buscarMedico()">Buscar</button>
            <button (click)="closeModal()">Cancelar</button>
          </div>
        </div>
      </div>
    </main>
  </div>